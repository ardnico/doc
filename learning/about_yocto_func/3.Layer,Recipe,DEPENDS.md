# DEPENDS / RDEPENDS / RRECOMMENDSã¨ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»ãƒ¬ã‚·ãƒ”ãƒ»ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ»rootfsã®é–¢ä¿‚

## å…¨ä½“æ§‹é€ å›³ï¼ˆä¾å­˜é–¢ä¿‚ã®æµã‚Œï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LAYERS                      â”‚
â”‚                                             â”‚
â”‚  meta / meta-wrlinux / meta-custom ...      â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Recipe (.bb)             â”‚ â”‚
â”‚  â”‚                                       â”‚ â”‚
â”‚  â”‚  DEPENDS        â†’ ãƒ“ãƒ«ãƒ‰æ™‚ä¾å­˜        â”‚ â”‚
â”‚  â”‚   (compile/link ã«å¿…è¦)               â”‚ â”‚
â”‚  â”‚                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚  â”‚ do_compile    â”‚â—€â”€ DEPENDS ãŒåŠ¹ã  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚                                       â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚ â”‚
â”‚  â”‚  â”‚ do_install    â”‚                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                           â”‚
â”‚                  â–¼                           â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚        â”‚  Package (rpm/ipk)     â”‚           â”‚
â”‚        â”‚  ${PN}, ${PN}-dev etc  â”‚           â”‚
â”‚        â”‚                        â”‚           â”‚
â”‚        â”‚  RDEPENDS      å¿…é ˆ    â”‚           â”‚
â”‚        â”‚  RRECOMMENDS   ä»»æ„    â”‚           â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                        â”‚                    â”‚
â”‚                        â–¼                    â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚            â”‚    packagegroup      â”‚         â”‚
â”‚            â”‚ (RDEPENDSã®æŸ)       â”‚         â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                       â”‚                     â”‚
â”‚                       â–¼                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚              â”‚     IMAGE        â”‚           â”‚
â”‚              â”‚ IMAGE_INSTALL    â”‚           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                       â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   ROOTFS   â”‚
                 â”‚ å®Ÿè¡Œç’°å¢ƒ   â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å½¹å‰²ã‚’ã€Œæ™‚é–“è»¸ã€ã§æ•´ç†ï¼ˆã“ã“ãŒé‡è¦ï¼‰

### ãƒ“ãƒ«ãƒ‰æ™‚ï¼ˆãƒ›ã‚¹ãƒˆå´ï¼‰

```
DEPENDS
  â†“
do_compile / do_configure
```

### å®Ÿè¡Œæ™‚ï¼ˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆå´ï¼‰

```
RDEPENDS / RRECOMMENDS
  â†“
rootfs ã«å«ã¾ã‚Œã‚‹
```

**DEPENDS ã¨ RDEPENDS ã¯â€œä¸–ç•ŒãŒé•ã†â€**
â†’ ã“ã“ã‚’æ··åŒã™ã‚‹ã¨ 100% ãƒãƒã‚‹ã€‚

---

## å„è¦ç´ ã®æ­£ç¢ºãªä½ç½®ã¥ã‘

---

## â‘  Layerï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰

```
meta-custom/
 â”” recipes-apps/
   â”” myapp/
     â”œ myapp.bb
     â”” myapp.bbappend
```

### ä½•è€…ï¼Ÿ

* **ãƒ¬ã‚·ãƒ”ã‚„è¨­å®šã®å…¥ã‚Œç‰©**
* å„ªå…ˆé †ä½ã‚’æŒã¤ï¼ˆå¾Œå‹ã¡ï¼‰

### ä¾å­˜é–¢ä¿‚ã¨ã®é–¢ä¿‚

* DEPENDS / RDEPENDS ã¯ **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã¯ãªããƒ¬ã‚·ãƒ”ã«æ›¸ã**
* ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯ã€Œã©ã®ãƒ¬ã‚·ãƒ”ç¾¤ãŒå­˜åœ¨ã™ã‚‹ã‹ã€ã‚’æ±ºã‚ã‚‹ã ã‘

---

## â‘¡ Recipeï¼ˆ.bbï¼‰

```
myapp.bb
```

### ä¸­ã§ä½•ã‚’æ›¸ãï¼Ÿ

```bitbake
DEPENDS = "libxml2 openssl"

RDEPENDS:${PN} = "bash openssl"
RRECOMMENDS:${PN} = "tzdata"
```

### å½¹å‰²åˆ†æ‹…

| å¤‰æ•°          | åŠ¹ãå ´æ‰€         | å½±éŸ¿           |
| ----------- | ------------ | ------------ |
| DEPENDS     | do_compile å‰ | ãƒ“ãƒ«ãƒ‰é †ãƒ»sysroot |
| RDEPENDS    | rootfsç”Ÿæˆ     | å¿…é ˆå®Ÿè¡Œç’°å¢ƒ       |
| RRECOMMENDS | rootfsç”Ÿæˆ     | ä»»æ„å®Ÿè¡Œç’°å¢ƒ       |

---

## â‘¢ DEPENDSï¼ˆãƒ“ãƒ«ãƒ‰æ™‚ä¾å­˜ï¼‰

```
[ Recipe A ]
   DEPENDS = "Recipe B"

â†’ Recipe B ãŒå…ˆã«ãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹
â†’ ãƒ˜ãƒƒãƒ€ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ sysroot ã«å…¥ã‚‹
```

### é‡è¦ãƒã‚¤ãƒ³ãƒˆ

* **rootfsã«ã¯å…¥ã‚‰ãªã„**
* ã‚ãã¾ã§ã€Œä½œã‚‹ãŸã‚ã®ä¾å­˜ã€

---

## â‘£ Packageï¼ˆç”Ÿæˆç‰©ï¼‰

```
myapp            â† å®Ÿè¡Œãƒã‚¤ãƒŠãƒª
myapp-dev        â† ãƒ˜ãƒƒãƒ€
myapp-dbg        â† ãƒ‡ãƒãƒƒã‚°
```

* DEPENDS ã¯ **ã“ã“ã«ã¯æ®‹ã‚‰ãªã„**
* RDEPENDS / RRECOMMENDS ã¯ **ã“ã“ã«ç´ã¥ã**

---

## â‘¤ RDEPENDSï¼ˆå®Ÿè¡Œæ™‚ãƒ»å¿…é ˆï¼‰

```
[ myapp package ]
   RDEPENDS = "libssl bash"

â†’ rootfs ã«å¿…ãšå…¥ã‚‹
â†’ ç„¡ã„ã¨èµ·å‹•æ™‚ã«æ­»ã¬
```

### å®Ÿå‹™æ„Ÿè¦š

* ã€Œç„¡ã„ã¨ç¢ºå®Ÿã«è½ã¡ã‚‹ã‚‚ã®ã€ã¯å…¨éƒ¨ RDEPENDS

---

## â‘¥ RRECOMMENDSï¼ˆå®Ÿè¡Œæ™‚ãƒ»ä»»æ„ï¼‰

```
[ myapp package ]
   RRECOMMENDS = "ca-certificates"
```

* åŸºæœ¬ã¯å…¥ã‚‹
* ãŸã ã— image / distro è¨­å®šã§å‰Šé™¤ã•ã‚Œã†ã‚‹

ğŸ‘‰ **ä¾¿åˆ©æ©Ÿèƒ½ãƒ»è£œåŠ©è¦ç´ ç”¨**

---

## â‘¦ packagegroupï¼ˆRDEPENDSã®æŸï¼‰

```
packagegroup-custom-base.bb

RDEPENDS:${PN} = "
  myapp
  mydriver
  systemd
"
```

### ä¾å­˜é–¢ä¿‚çš„ãªç«‹ã¡ä½ç½®

```
feature
  â†“
packagegroupï¼ˆRDEPENDSã®é›†åˆï¼‰
  â†“
image
```

* DEPENDS ã¯æ›¸ã‹ãªã„
* **å®Ÿè¡Œç’°å¢ƒè¨­è¨ˆã®ãŸã‚ã®å­˜åœ¨**

---

## â‘§ IMAGEï¼ˆæœ€çµ‚ç®±ï¼‰

```
IMAGE_INSTALL += "packagegroup-custom-base"
```

### ä½•ãŒèµ·ãã‚‹ï¼Ÿ

```
IMAGE
 â†“
packagegroup
 â†“
RDEPENDS / RRECOMMENDS
 â†“
rootfså®Œæˆ
```

---

## ã‚ˆãã‚ã‚‹èª¤è§£ã‚’å›³ã§å¦å®šã™ã‚‹

### âŒã€ŒDEPENDS æ›¸ã„ãŸã‹ã‚‰ rootfs ã«å…¥ã‚‹ã€

```
DEPENDS
  â”œâ”€âœ” build OK
  â””â”€âœ˜ rootfs ã«ã¯å…¥ã‚‰ãªã„
```

### âŒã€Œfeature æ›¸ã‘ã°å‹æ‰‹ã«å…¥ã‚‹ã€

```
feature
  â””â”€ æ¡ä»¶ãªã ã‘ï¼ˆä¸­èº«ãªã—ï¼‰
```

---

## æ­£ã—ã„è¨­è¨ˆã®ä¸€æœ¬é“ï¼ˆé‡è¦ï¼‰

```
[MACHINE / DISTRO FEATURE]
          â†“
    [packagegroup]
          â†“
        [IMAGE]
          â†“
        [ROOTFS]
```

**DEPENDS ã¯ã“ã®æµã‚Œã®å¤–ï¼ˆãƒ“ãƒ«ãƒ‰å´ï¼‰**

---

## ä»Šã®ç†è§£æ®µéšã§ã®æ ¸å¿ƒã¾ã¨ã‚

> * **DEPENDS**ï¼šãƒ“ãƒ«ãƒ‰ã®éƒ½åˆ
> * **RDEPENDS**ï¼šç”Ÿæ­»ã‚’åˆ†ã‘ã‚‹å®Ÿè¡Œè¦ä»¶
> * **RRECOMMENDS**ï¼šã‚ã‚‹ã¨å¹¸ã›
> * **ãƒ¬ã‚¤ãƒ¤ãƒ¼**ï¼šç½®ãå ´æ‰€
> * **ãƒ¬ã‚·ãƒ”**ï¼šè²¬å‹™ã®å˜ä½
> * **packagegroup**ï¼šå®Ÿè¡Œç’°å¢ƒã®è¨­è¨ˆå›³
